<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Link Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="container">
    <h2>Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ ÑÑÑ‹Ğ»Ğ¾Ğº</h2>

    <form method="post" class="card">
        <input name="title" placeholder="ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑÑ‹Ğ»ĞºĞ¸" required>
        <input name="url" placeholder="https://example.com" required>
        <textarea name="comment" placeholder="ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹"></textarea>
        <button class="btn primary">â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
    </form>

    {% for link in links %}
    {% set short_url = request.host_url ~ 's/' ~ link[3] %}
    <div class="card link-card">

        <h3 class="link-title">
            <img class="favicon"
                 src="https://www.google.com/s2/favicons?domain={{ link[2] }}">
            <a href="{{ short_url }}" target="_blank">{{ link[1] }}</a>
        </h3>

        <p class="comment">{{ link[4] }}</p>

        <div class="short-url">
            ğŸ”— ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ°Ñ ÑÑÑ‹Ğ»ĞºĞ°:
            <a href="{{ short_url }}" target="_blank">{{ short_url }}</a>
        </div>

        <select onchange="updateCode(this, '{{ short_url }}', '{{ link[1] }}')">
            <option value="html">ğŸ”— HTML</option>
            <option value="md">ğŸ“„ Markdown</option>
            <option value="text">ğŸ“ Ğ¢ĞµĞºÑÑ‚</option>
        </select>

        <textarea class="code" readonly>
<a href="{{ short_url }}">{{ link[1] }}</a>
        </textarea>

        <div class="actions">
            <button class="btn copy" onclick="copyCode(this)">ğŸ“‹ ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ</button>
            <a class="btn delete" href="/delete/{{ link[0] }}">ğŸ—‘ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ</a>
        </div>

    </div>
    {% endfor %}

    <a class="logout" href="/logout">ğŸšª Ğ’Ñ‹Ğ¹Ñ‚Ğ¸</a>
</div>

<script>
function updateCode(select, url, title) {
    const textarea = select.nextElementSibling;

    if (select.value === 'html') {
        textarea.value = `<a href="${url}">${title}</a>`;
    }
    else if (select.value === 'md') {
        textarea.value = `[${title}](${url})`;
    }
    else {
        textarea.value = `${title} â€” ${url}`;
    }
}

function copyCode(btn) {
    const textarea = btn.parentElement.previousElementSibling;
    textarea.select();
    textarea.setSelectionRange(0, 99999);
    document.execCommand("copy");

    btn.innerText = "âœ… Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾";
    setTimeout(() => btn.innerText = "ğŸ“‹ ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ", 1500);
}
</script>

</body>
</html>
